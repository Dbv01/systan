<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SA Toolkit Pro - Рабочая станция системного аналитика</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <!-- Marked.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Chart.js для графиков -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --accent-primary: #38bdf8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        .tab-active {
            border-bottom-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .card {
            background-color: var(--bg-card);
            border-radius: 0.75rem;
            border: 1px solid #334155;
            transition: all 0.2s;
        }
        
        .card:hover {
            border-color: #475569;
        }
        
        .code-block {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
        }
        
        .json-error {
            border-color: var(--danger) !important;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #1e293b;
            color: #f1f5f9;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid #334155;
            font-size: 0.875rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .checkbox-item {
            transition: all 0.2s;
        }
        
        .checkbox-item:hover {
            background-color: rgba(56, 189, 248, 0.1);
        }
        
        /* Скроллбар стилизация */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        
        .mermaid {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        
        .kanban-column {
            min-height: 500px;
            background: rgba(30, 41, 59, 0.5);
        }
        
        .kanban-item {
            transition: all 0.2s;
            cursor: move;
        }
        
        .kanban-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .swot-cell {
            min-height: 120px;
        }
        
        .requirement-high {
            border-left: 4px solid #ef4444;
        }
        
        .requirement-medium {
            border-left: 4px solid #f59e0b;
        }
        
        .requirement-low {
            border-left: 4px solid #10b981;
        }
        
        .matrix-cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .matrix-cell.active {
            background-color: #38bdf8;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .modal-content {
            background-color: var(--bg-card);
            margin: 5% auto;
            padding: 20px;
            border-radius: 0.75rem;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-modal:hover {
            color: white;
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        /* Стили для матрицы трассируемости */
        .trace-matrix {
            display: grid;
            gap: 2px;
            overflow-x: auto;
        }
        
        .trace-header {
            background-color: #334155;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            left: 0;
        }
        
        .trace-cell {
            background-color: #1e293b;
            padding: 8px;
            text-align: center;
            min-width: 40px;
            cursor: pointer;
        }
        
        .trace-cell.linked {
            background-color: #38bdf8;
            color: white;
        }
        
        /* Стили для BPMN */
        .bpmn-task {
            fill: #38bdf8;
            stroke: #0ea5e9;
        }
        
        .bpmn-gateway {
            fill: #f59e0b;
            stroke: #d97706;
        }
        
        .bpmn-event {
            fill: #10b981;
            stroke: #059669;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Заголовок и управление -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-sky-400 flex items-center gap-2">
                    <i data-lucide="briefcase" class="w-8 h-8"></i> SA Toolkit Pro
                </h1>
                <p class="text-slate-300 mt-2">Полнофункциональная рабочая станция системного аналитика</p>
                <div class="flex items-center gap-2 mt-2 text-sm text-slate-400">
                    <i data-lucide="user" class="w-4 h-4"></i>
                    <span id="current-project">Проект: Новый функционал</span>
                </div>
            </div>
            <div class="flex flex-wrap gap-3">
                <div class="tooltip">
                    <button id="new-project" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                        <i data-lucide="plus-circle" class="w-4 h-4"></i> Новый проект
                    </button>
                    <span class="tooltiptext">Создать новый проект анализа</span>
                </div>
                <div class="tooltip">
                    <button id="export-all" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                        <i data-lucide="download" class="w-4 h-4"></i> Экспорт
                    </button>
                    <span class="tooltiptext">Экспортировать все данные проекта</span>
                </div>
                <div class="tooltip">
                    <button id="import-all" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                        <i data-lucide="upload" class="w-4 h-4"></i> Импорт
                    </button>
                    <span class="tooltiptext">Импортировать данные проекта</span>
                </div>
                <div class="tooltip">
                    <button id="settings" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                        <i data-lucide="settings" class="w-4 h-4"></i> Настройки
                    </button>
                    <span class="tooltiptext">Настройки приложения</span>
                </div>
            </div>
        </header>

        <!-- Навигация -->
        <nav class="flex flex-wrap border-b border-slate-700 mb-6 overflow-x-auto">
            <button data-tab="dashboard" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="layout-dashboard" class="w-4 h-4"></i> Дашборд
            </button>
            <button data-tab="requirements" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="file-text" class="w-4 h-4"></i> Требования
            </button>
            <button data-tab="templates" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="file-edit" class="w-4 h-4"></i> Шаблоны
            </button>
            <button data-tab="diagrams" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="git-branch" class="w-4 h-4"></i> Диаграммы
            </button>
            <button data-tab="processes" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="workflow" class="w-4 h-4"></i> Процессы
            </button>
            <button data-tab="models" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="database" class="w-4 h-4"></i> Модели данных
            </button>
            <button data-tab="api" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="server" class="w-4 h-4"></i> API
            </button>
            <button data-tab="traceability" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="link" class="w-4 h-4"></i> Трассируемость
            </button>
            <button data-tab="analytics" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="bar-chart" class="w-4 h-4"></i> Аналитика
            </button>
            <button data-tab="testing" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="test-tube" class="w-4 h-4"></i> Тестирование
            </button>
            <button data-tab="tools" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="tool" class="w-4 h-4"></i> Инструменты
            </button>
            <button data-tab="reference" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="book-open" class="w-4 h-4"></i> Справочник
            </button>
            <button data-tab="checklists" class="tab-btn py-3 px-4 font-medium text-slate-300 hover:text-sky-400 transition border-b-2 border-transparent hover:border-sky-400 flex items-center gap-2">
                <i data-lucide="check-circle" class="w-4 h-4"></i> Качество
            </button>
        </nav>

        <!-- Основное содержимое -->
        <main>
            <!-- Дашборд -->
            <div id="dashboard" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <!-- Статистика проекта -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="trending-up" class="w-5 h-5"></i> Статистика проекта
                        </h2>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-300">Требования</span>
                                <span class="text-2xl font-bold text-sky-400" id="req-count">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-300">Завершено</span>
                                <span class="text-2xl font-bold text-emerald-400" id="req-completed">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-300">Диаграммы</span>
                                <span class="text-2xl font-bold text-amber-400" id="diagram-count">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-slate-300">Тест-кейсы</span>
                                <span class="text-2xl font-bold text-purple-400" id="test-count">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Прогресс проекта -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="target" class="w-5 h-5"></i> Прогресс проекта
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Анализ требований</span>
                                    <span class="text-sky-400" id="progress-req">0%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-sky-600 h-2 rounded-full transition-all" id="progress-bar-req" style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Проектирование</span>
                                    <span class="text-sky-400" id="progress-design">0%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-amber-600 h-2 rounded-full transition-all" id="progress-bar-design" style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Тестирование</span>
                                    <span class="text-sky-400" id="progress-test">0%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-emerald-600 h-2 rounded-full transition-all" id="progress-bar-test" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ближайшие задачи -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="clock" class="w-5 h-5"></i> Ближайшие задачи
                        </h2>
                        <div class="space-y-3" id="upcoming-tasks">
                            <div class="text-center py-4 text-slate-400">
                                <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2"></i>
                                <p>Задачи не добавлены</p>
                            </div>
                        </div>
                        <button id="add-task" class="w-full mt-4 flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                            <i data-lucide="plus" class="w-4 h-4"></i> Добавить задачу
                        </button>
                    </div>
                </div>

                <!-- Последние активности -->
                <div class="card p-6">
                    <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                        <i data-lucide="activity" class="w-5 h-5"></i> Последние активности
                    </h2>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="text-left py-3 px-4 text-slate-300">Время</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Действие</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Объект</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Статус</th>
                                </tr>
                            </thead>
                            <tbody id="activity-log">
                                <tr>
                                    <td class="py-3 px-4 text-slate-400" colspan="4" class="text-center">Нет активностей</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Управление требованиями -->
            <div id="requirements" class="tab-content hidden">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="file-text" class="w-5 h-5"></i> Управление требованиями
                        </h2>
                        <div class="flex gap-2">
                            <button id="add-requirement" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="plus" class="w-4 h-4"></i> Новое требование
                            </button>
                            <button id="import-req" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                <i data-lucide="upload" class="w-4 h-4"></i> Импорт
                            </button>
                            <button id="export-req" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="download" class="w-4 h-4"></i> Экспорт
                            </button>
                        </div>
                    </div>

                    <!-- Фильтры требований -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <select id="filter-status" class="p-2 bg-slate-800 border border-slate-700 rounded-lg">
                            <option value="all">Все статусы</option>
                            <option value="draft">Черновик</option>
                            <option value="review">На рассмотрении</option>
                            <option value="approved">Утверждено</option>
                            <option value="rejected">Отклонено</option>
                            <option value="implemented">Реализовано</option>
                        </select>
                        <select id="filter-priority" class="p-2 bg-slate-800 border border-slate-700 rounded-lg">
                            <option value="all">Все приоритеты</option>
                            <option value="high">Высокий</option>
                            <option value="medium">Средний</option>
                            <option value="low">Низкий</option>
                        </select>
                        <select id="filter-type" class="p-2 bg-slate-800 border border-slate-700 rounded-lg">
                            <option value="all">Все типы</option>
                            <option value="functional">Функциональные</option>
                            <option value="non-functional">Нефункциональные</option>
                            <option value="business">Бизнес-требования</option>
                            <option value="user">Пользовательские</option>
                        </select>
                        <input type="text" id="search-req" placeholder="Поиск требований..." class="p-2 bg-slate-800 border border-slate-700 rounded-lg">
                    </div>

                    <!-- Список требований -->
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="text-left py-3 px-4 text-slate-300">ID</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Требование</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Тип</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Приоритет</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Статус</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Дата</th>
                                    <th class="text-left py-3 px-4 text-slate-300">Действия</th>
                                </tr>
                            </thead>
                            <tbody id="requirements-list">
                                <!-- Требования будут добавляться динамически -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Приоритизация требований (MoSCoW) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                    <div class="card p-6">
                        <h3 class="text-lg font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="filter" class="w-5 h-5"></i> Приоритизация MoSCoW
                        </h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-red-900/30 border border-red-800/50 rounded-lg">
                                <div class="font-bold text-red-400">MUST HAVE</div>
                                <div class="text-sm text-slate-300 mt-2">Критически важные требования</div>
                                <div id="must-have-list" class="mt-3 space-y-2"></div>
                            </div>
                            <div class="p-4 bg-orange-900/30 border border-orange-800/50 rounded-lg">
                                <div class="font-bold text-orange-400">SHOULD HAVE</div>
                                <div class="text-sm text-slate-300 mt-2">Важные, но не критичные</div>
                                <div id="should-have-list" class="mt-3 space-y-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-900/30 border border-blue-800/50 rounded-lg">
                                <div class="font-bold text-blue-400">COULD HAVE</div>
                                <div class="text-sm text-slate-300 mt-2">Желательные улучшения</div>
                                <div id="could-have-list" class="mt-3 space-y-2"></div>
                            </div>
                            <div class="p-4 bg-slate-800/50 border border-slate-700 rounded-lg">
                                <div class="font-bold text-slate-400">WON'T HAVE</div>
                                <div class="text-sm text-slate-300 mt-2">Отложенные требования</div>
                                <div id="wont-have-list" class="mt-3 space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Шаблоны документов -->
            <div id="templates" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <!-- Боковая панель с шаблонами -->
                    <div class="lg:col-span-1">
                        <div class="card p-6 mb-6">
                            <h3 class="text-lg font-bold text-sky-400 mb-4">Категории шаблонов</h3>
                            <div class="space-y-2">
                                <button data-category="all" class="category-btn w-full text-left p-3 rounded-lg bg-sky-600 text-white">
                                    Все шаблоны
                                </button>
                                <button data-category="analysis" class="category-btn w-full text-left p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition">
                                    Анализ
                                </button>
                                <button data-category="design" class="category-btn w-full text-left p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition">
                                    Проектирование
                                </button>
                                <button data-category="api" class="category-btn w-full text-left p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition">
                                    API
                                </button>
                                <button data-category="testing" class="category-btn w-full text-left p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition">
                                    Тестирование
                                </button>
                                <button data-category="management" class="category-btn w-full text-left p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition">
                                    Управление
                                </button>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <h3 class="text-lg font-bold text-sky-400 mb-4">Мои шаблоны</h3>
                            <div id="custom-templates" class="space-y-2">
                                <div class="text-sm text-slate-400 p-2">Пользовательские шаблоны не добавлены</div>
                            </div>
                            <button id="add-custom-template" class="w-full mt-4 flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                <i data-lucide="plus" class="w-4 h-4"></i> Новый шаблон
                            </button>
                        </div>
                    </div>

                    <!-- Основная область с шаблонами -->
                    <div class="lg:col-span-3">
                        <div class="card p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold text-sky-400">Шаблоны документов</h2>
                                <div class="flex gap-2">
                                    <button id="save-template" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                        <i data-lucide="save" class="w-4 h-4"></i> Сохранить
                                    </button>
                                    <button id="export-template" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                        <i data-lucide="download" class="w-4 h-4"></i> Экспорт
                                    </button>
                                </div>
                            </div>

                            <!-- Сетка шаблонов -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="templates-grid">
                                <!-- Шаблоны будут добавляться динамически -->
                            </div>

                            <!-- Редактор шаблона -->
                            <div class="mt-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-bold text-slate-300">Редактор шаблона</h3>
                                    <div class="flex gap-2">
                                        <button id="copy-template" class="flex items-center gap-2 px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                            <i data-lucide="copy" class="w-3 h-3"></i> Копировать
                                        </button>
                                        <button id="clear-template" class="flex items-center gap-2 px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                            <i data-lucide="trash-2" class="w-3 h-3"></i> Очистить
                                        </button>
                                    </div>
                                </div>
                                <textarea id="template-editor" class="w-full h-96 p-4 bg-slate-900 text-slate-100 rounded-lg border border-slate-700 focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none code-block" placeholder="Выберите шаблон..."></textarea>
                                <div class="mt-2 text-sm text-slate-400 flex justify-between">
                                    <span>Автосохранение: <span id="template-save-status" class="text-green-400">Включено</span></span>
                                    <span id="template-char-count">0 символов</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Диаграммы -->
            <div id="diagrams" class="tab-content hidden">
                <div class="card p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="git-branch" class="w-5 h-5"></i> Библиотека диаграмм
                        </h2>
                        <div class="flex gap-2">
                            <button id="new-diagram" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="plus" class="w-4 h-4"></i> Новая диаграмма
                            </button>
                            <button id="export-diagrams" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="download" class="w-4 h-4"></i> Экспорт всех
                            </button>
                        </div>
                    </div>

                    <!-- Список диаграмм -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="diagrams-list">
                        <!-- Диаграммы будут добавляться динамически -->
                    </div>

                    <!-- Редактор диаграмм -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="font-medium text-slate-300">Редактор Mermaid</h3>
                                <div class="flex gap-2">
                                    <button id="render-diagram" class="flex items-center gap-2 px-3 py-1 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition text-sm">
                                        <i data-lucide="refresh-cw" class="w-3 h-3"></i> Обновить
                                    </button>
                                    <button id="save-diagram" class="flex items-center gap-2 px-3 py-1 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition text-sm">
                                        <i data-lucide="save" class="w-3 h-3"></i> Сохранить
                                    </button>
                                </div>
                            </div>
                            <textarea id="mermaid-editor" class="w-full h-96 p-4 bg-slate-900 text-slate-100 rounded-lg border border-slate-700 focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none code-block" placeholder="Введите код диаграммы Mermaid..."></textarea>
                            <div class="mt-3">
                                <h4 class="font-medium text-slate-300 mb-2">Быстрые шаблоны:</h4>
                                <div class="flex flex-wrap gap-2">
                                    <button data-example="flowchart" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                        Блок-схема
                                    </button>
                                    <button data-example="sequence" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                        Последовательность
                                    </button>
                                    <button data-example="class" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                        Классы
                                    </button>
                                    <button data-example="state" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                        Состояния
                                    </button>
                                    <button data-example="er" class="px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                        ER-диаграмма
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="font-medium text-slate-300">Предпросмотр</h3>
                                <button id="export-png" class="flex items-center gap-2 px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                    <i data-lucide="image" class="w-3 h-3"></i> Экспорт PNG
                                </button>
                            </div>
                            <div id="diagram-preview" class="w-full h-96 border border-slate-700 rounded-lg bg-white overflow-auto flex items-center justify-center p-4">
                                <p class="text-slate-500 text-center">Диаграмма появится здесь</p>
                            </div>
                            <div class="mt-3">
                                <input type="text" id="diagram-title" placeholder="Название диаграммы" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Процессы -->
            <div id="processes" class="tab-content hidden">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="workflow" class="w-5 h-5"></i> Моделирование процессов
                        </h2>
                        <div class="flex gap-2">
                            <button id="new-process" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="plus" class="w-4 h-4"></i> Новый процесс
                            </button>
                            <button id="analyze-process" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="bar-chart" class="w-4 h-4"></i> Анализ
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Список процессов -->
                        <div class="lg:col-span-1">
                            <div class="card p-4 mb-4">
                                <h3 class="font-bold text-slate-300 mb-3">Процессы</h3>
                                <div id="processes-list" class="space-y-2">
                                    <!-- Процессы будут добавляться динамически -->
                                </div>
                            </div>
                            
                            <!-- Элементы BPMN -->
                            <div class="card p-4">
                                <h3 class="font-bold text-slate-300 mb-3">Элементы BPMN</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="bpmn-element p-3 text-center bg-slate-800 rounded-lg cursor-pointer" data-type="task">
                                        <div class="w-8 h-8 mx-auto mb-2 bg-sky-500 rounded"></div>
                                        <span class="text-sm">Задача</span>
                                    </div>
                                    <div class="bpmn-element p-3 text-center bg-slate-800 rounded-lg cursor-pointer" data-type="gateway">
                                        <div class="w-8 h-8 mx-auto mb-2 bg-amber-500 rounded-full"></div>
                                        <span class="text-sm">Шлюз</span>
                                    </div>
                                    <div class="bpmn-element p-3 text-center bg-slate-800 rounded-lg cursor-pointer" data-type="event">
                                        <div class="w-8 h-8 mx-auto mb-2 bg-emerald-500 rounded-full border-4"></div>
                                        <span class="text-sm">Событие</span>
                                    </div>
                                    <div class="bpmn-element p-3 text-center bg-slate-800 rounded-lg cursor-pointer" data-type="pool">
                                        <div class="w-8 h-8 mx-auto mb-2 border-2 border-slate-400"></div>
                                        <span class="text-sm">Пул</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Редактор процесса -->
                        <div class="lg:col-span-2">
                            <div class="card p-4 h-full">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-bold text-slate-300">Редактор процесса</h3>
                                    <input type="text" id="process-name" placeholder="Название процесса" class="p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                </div>
                                
                                <!-- Холст для процесса -->
                                <div id="process-canvas" class="border-2 border-dashed border-slate-700 rounded-lg min-h-96 p-4">
                                    <div class="text-center text-slate-500 py-8">
                                        <i data-lucide="move" class="w-12 h-12 mx-auto mb-4"></i>
                                        <p>Перетащите элементы сюда для создания процесса</p>
                                    </div>
                                </div>
                                
                                <!-- Описание процесса -->
                                <div class="mt-4">
                                    <h4 class="font-medium text-slate-300 mb-2">Описание процесса:</h4>
                                    <textarea id="process-description" class="w-full h-32 p-3 bg-slate-800 border border-slate-700 rounded-lg" placeholder="Опишите бизнес-процесс..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Модели данных -->
            <div id="models" class="tab-content hidden">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="database" class="w-5 h-5"></i> Моделирование данных
                        </h2>
                        <div class="flex gap-2">
                            <button id="new-model" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="plus" class="w-4 h-4"></i> Новая модель
                            </button>
                            <button id="generate-sql" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="code" class="w-4 h-4"></i> Генерация SQL
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Список сущностей -->
                        <div class="lg:col-span-1">
                            <div class="card p-4 mb-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="font-bold text-slate-300">Сущности</h3>
                                    <button id="add-entity" class="flex items-center gap-1 px-2 py-1 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition text-sm">
                                        <i data-lucide="plus" class="w-3 h-3"></i> Добавить
                                    </button>
                                </div>
                                <div id="entities-list" class="space-y-2">
                                    <!-- Сущности будут добавляться динамически -->
                                </div>
                            </div>
                            
                            <!-- Типы данных -->
                            <div class="card p-4">
                                <h3 class="font-bold text-slate-300 mb-3">Типы данных</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="p-2 bg-slate-800 rounded text-sm">String</div>
                                    <div class="p-2 bg-slate-800 rounded text-sm">Integer</div>
                                    <div class="p-2 bg-slate-800 rounded text-sm">Boolean</div>
                                    <div class="p-2 bg-slate-800 rounded text-sm">DateTime</div>
                                    <div class="p-2 bg-slate-800 rounded text-sm">Decimal</div>
                                    <div class="p-2 bg-slate-800 rounded text-sm">Text</div>
                                </div>
                            </div>
                        </div>

                        <!-- Редактор сущности -->
                        <div class="lg:col-span-2">
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-bold text-slate-300">Редактор сущности</h3>
                                    <input type="text" id="entity-name" placeholder="Название сущности" class="p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                </div>
                                
                                <!-- Атрибуты сущности -->
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-medium text-slate-300">Атрибуты</h4>
                                        <button id="add-attribute" class="flex items-center gap-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                            <i data-lucide="plus" class="w-3 h-3"></i> Добавить атрибут
                                        </button>
                                    </div>
                                    <div id="attributes-list">
                                        <div class="text-center p-4 text-slate-500">
                                            <p>Добавьте атрибуты для сущности</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Связи -->
                                <div>
                                    <h4 class="font-medium text-slate-300 mb-2">Связи</h4>
                                    <div id="relationships-list">
                                        <div class="text-center p-4 text-slate-500">
                                            <p>Определите связи между сущностями</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API -->
            <div id="api" class="tab-content hidden">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="server" class="w-5 h-5"></i> Проектирование API
                        </h2>
                        <div class="flex gap-2">
                            <button id="new-endpoint" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="plus" class="w-4 h-4"></i> Новый endpoint
                            </button>
                            <button id="import-swagger" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                <i data-lucide="upload" class="w-4 h-4"></i> Импорт Swagger
                            </button>
                            <button id="export-openapi" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="download" class="w-4 h-4"></i> Экспорт OpenAPI
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Список эндпоинтов -->
                        <div class="lg:col-span-1">
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="font-bold text-slate-300">Endpoints</h3>
                                    <div class="flex gap-1">
                                        <select id="filter-method" class="p-1 bg-slate-800 border border-slate-700 rounded text-sm">
                                            <option value="all">Все методы</option>
                                            <option value="GET">GET</option>
                                            <option value="POST">POST</option>
                                            <option value="PUT">PUT</option>
                                            <option value="DELETE">DELETE</option>
                                            <option value="PATCH">PATCH</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="endpoints-list" class="space-y-2">
                                    <!-- Endpoints будут добавляться динамически -->
                                </div>
                            </div>
                        </div>

                        <!-- Редактор эндпоинта -->
                        <div class="lg:col-span-2">
                            <div class="card p-4">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm text-slate-300 mb-1">Метод</label>
                                        <select id="api-method" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                            <option value="GET">GET</option>
                                            <option value="POST">POST</option>
                                            <option value="PUT">PUT</option>
                                            <option value="DELETE">DELETE</option>
                                            <option value="PATCH">PATCH</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-slate-300 mb-1">Путь</label>
                                        <input type="text" id="api-path" placeholder="/api/v1/users" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                    </div>
                                </div>
                                
                                <!-- Описание -->
                                <div class="mb-4">
                                    <label class="block text-sm text-slate-300 mb-1">Описание</label>
                                    <input type="text" id="api-description" placeholder="Описание endpoint" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                </div>
                                
                                <!-- Параметры запроса -->
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-medium text-slate-300">Параметры запроса</h4>
                                        <button id="add-param" class="flex items-center gap-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                            <i data-lucide="plus" class="w-3 h-3"></i> Добавить
                                        </button>
                                    </div>
                                    <div id="params-list"></div>
                                </div>
                                
                                <!-- Тело запроса -->
                                <div class="mb-4">
                                    <h4 class="font-medium text-slate-300 mb-2">Тело запроса</h4>
                                    <textarea id="api-request-body" class="w-full h-32 p-3 bg-slate-800 border border-slate-700 rounded-lg code-block" placeholder='{"key": "value"}'></textarea>
                                </div>
                                
                                <!-- Ответы -->
                                <div>
                                    <h4 class="font-medium text-slate-300 mb-2">Ответы</h4>
                                    <div id="responses-list"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Матрица трассируемости -->
            <div id="traceability" class="tab-content hidden">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="link" class="w-5 h-5"></i> Матрица трассируемости
                        </h2>
                        <div class="flex gap-2">
                            <button id="auto-trace" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="zap" class="w-4 h-4"></i> Авто-трассировка
                            </button>
                            <button id="export-trace" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="download" class="w-4 h-4"></i> Экспорт матрицы
                            </button>
                        </div>
                    </div>

                    <div class="mb-6">
                        <div class="grid grid-cols-4 gap-4 mb-4">
                            <div class="card p-4 text-center">
                                <div class="text-2xl font-bold text-sky-400" id="trace-req-count">0</div>
                                <div class="text-sm text-slate-300">Требования</div>
                            </div>
                            <div class="card p-4 text-center">
                                <div class="text-2xl font-bold text-emerald-400" id="trace-tests-count">0</div>
                                <div class="text-sm text-slate-300">Тест-кейсы</div>
                            </div>
                            <div class="card p-4 text-center">
                                <div class="text-2xl font-bold text-amber-400" id="trace-tasks-count">0</div>
                                <div class="text-sm text-slate-300">Задачи</div>
                            </div>
                            <div class="card p-4 text-center">
                                <div class="text-2xl font-bold text-purple-400" id="trace-coverage">0%</div>
                                <div class="text-sm text-slate-300">Покрытие</div>
                            </div>
                        </div>
                    </div>

                    <!-- Матрица -->
                    <div class="overflow-x-auto">
                        <div id="traceability-matrix" class="trace-matrix">
                            <!-- Матрица будет генерироваться динамически -->
                        </div>
                    </div>

                    <!-- Легенда -->
                    <div class="mt-6 flex items-center gap-4 text-sm">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-sky-500"></div>
                            <span class="text-slate-300">Связано</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-slate-700"></div>
                            <span class="text-slate-300">Не связано</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-emerald-500"></div>
                            <span class="text-slate-300">Протестировано</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Аналитика -->
            <div id="analytics" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- SWOT анализ -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="target" class="w-5 h-5"></i> SWOT анализ
                        </h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="swot-cell p-4 bg-emerald-900/30 border border-emerald-800/50 rounded-lg">
                                <div class="font-bold text-emerald-400 mb-2">Сильные стороны</div>
                                <div id="strengths-list" class="space-y-2">
                                    <div class="text-sm text-slate-300">- Простая интеграция</div>
                                    <div class="text-sm text-slate-300">- Современные технологии</div>
                                </div>
                                <button class="mt-2 text-sm text-emerald-400 hover:text-emerald-300">+ Добавить</button>
                            </div>
                            <div class="swot-cell p-4 bg-red-900/30 border border-red-800/50 rounded-lg">
                                <div class="font-bold text-red-400 mb-2">Слабые стороны</div>
                                <div id="weaknesses-list" class="space-y-2">
                                    <div class="text-sm text-slate-300">- Ограниченная документация</div>
                                </div>
                                <button class="mt-2 text-sm text-red-400 hover:text-red-300">+ Добавить</button>
                            </div>
                            <div class="swot-cell p-4 bg-amber-900/30 border border-amber-800/50 rounded-lg">
                                <div class="font-bold text-amber-400 mb-2">Возможности</div>
                                <div id="opportunities-list" class="space-y-2">
                                    <div class="text-sm text-slate-300">- Расширение функционала</div>
                                </div>
                                <button class="mt-2 text-sm text-amber-400 hover:text-amber-300">+ Добавить</button>
                            </div>
                            <div class="swot-cell p-4 bg-slate-800 border border-slate-700 rounded-lg">
                                <div class="font-bold text-slate-400 mb-2">Угрозы</div>
                                <div id="threats-list" class="space-y-2">
                                    <div class="text-sm text-slate-300">- Конкуренция</div>
                                </div>
                                <button class="mt-2 text-sm text-slate-400 hover:text-slate-300">+ Добавить</button>
                            </div>
                        </div>
                    </div>

                    <!-- Статистика -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="bar-chart" class="w-5 h-5"></i> Статистика проекта
                        </h2>
                        <canvas id="project-chart" height="300"></canvas>
                    </div>

                    <!-- Анализ рисков -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="alert-triangle" class="w-5 h-5"></i> Матрица рисков
                        </h2>
                        <div class="grid grid-cols-5 gap-1 mb-2">
                            <div class="text-xs text-slate-400 text-center">Вероятность</div>
                            <div class="col-span-4">
                                <div class="flex justify-between text-xs text-slate-400">
                                    <span>Низкая</span>
                                    <span>Высокая</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-1">
                            <div class="grid grid-cols-5 gap-1">
                                <div class="text-xs text-slate-400 text-center py-2">Высокая</div>
                                <div class="matrix-cell bg-red-900/30" data-x="1" data-y="4"></div>
                                <div class="matrix-cell bg-red-900/50" data-x="2" data-y="4"></div>
                                <div class="matrix-cell bg-red-900/70" data-x="3" data-y="4"></div>
                                <div class="matrix-cell bg-red-900/90" data-x="4" data-y="4"></div>
                            </div>
                            <div class="grid grid-cols-5 gap-1">
                                <div class="text-xs text-slate-400 text-center py-2">Средняя</div>
                                <div class="matrix-cell bg-amber-900/30" data-x="1" data-y="3"></div>
                                <div class="matrix-cell bg-amber-900/50" data-x="2" data-y="3"></div>
                                <div class="matrix-cell bg-amber-900/70" data-x="3" data-y="3"></div>
                                <div class="matrix-cell bg-amber-900/90" data-x="4" data-y="3"></div>
                            </div>
                            <div class="grid grid-cols-5 gap-1">
                                <div class="text-xs text-slate-400 text-center py-2">Низкая</div>
                                <div class="matrix-cell bg-emerald-900/30" data-x="1" data-y="2"></div>
                                <div class="matrix-cell bg-emerald-900/50" data-x="2" data-y="2"></div>
                                <div class="matrix-cell bg-emerald-900/70" data-x="3" data-y="2"></div>
                                <div class="matrix-cell bg-emerald-900/90" data-x="4" data-y="2"></div>
                            </div>
                        </div>
                        <div class="mt-4" id="risk-list">
                            <div class="text-sm text-slate-400 mb-2">Добавленные риски:</div>
                            <!-- Риски будут добавляться динамически -->
                        </div>
                    </div>

                    <!-- Метрики качества -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="trending-up" class="w-5 h-5"></i> Метрики качества
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Полнота требований</span>
                                    <span class="text-sky-400">85%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-sky-600 h-2 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Трассируемость</span>
                                    <span class="text-sky-400">70%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-sky-600 h-2 rounded-full" style="width: 70%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Качество спецификаций</span>
                                    <span class="text-sky-400">90%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-sky-600 h-2 rounded-full" style="width: 90%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-slate-300">Согласованность</span>
                                    <span class="text-sky-400">75%</span>
                                </div>
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-sky-600 h-2 rounded-full" style="width: 75%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Тестирование -->
            <div id="testing" class="tab-content hidden">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="test-tube" class="w-5 h-5"></i> Управление тестированием
                        </h2>
                        <div class="flex gap-2">
                            <button id="new-test-case" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="plus" class="w-4 h-4"></i> Новый тест-кейс
                            </button>
                            <button id="generate-tests" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="zap" class="w-4 h-4"></i> Генерация из требований
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Список тест-кейсов -->
                        <div class="lg:col-span-1">
                            <div class="card p-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="font-bold text-slate-300">Тест-кейсы</h3>
                                    <select id="filter-test-status" class="p-1 bg-slate-800 border border-slate-700 rounded text-sm">
                                        <option value="all">Все статусы</option>
                                        <option value="draft">Черновик</option>
                                        <option value="ready">Готов</option>
                                        <option value="passed">Пройден</option>
                                        <option value="failed">Провален</option>
                                    </select>
                                </div>
                                <div id="test-cases-list" class="space-y-2">
                                    <!-- Тест-кейсы будут добавляться динамически -->
                                </div>
                            </div>
                        </div>

                        <!-- Редактор тест-кейса -->
                        <div class="lg:col-span-2">
                            <div class="card p-4">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm text-slate-300 mb-1">ID тест-кейса</label>
                                        <input type="text" id="test-id" placeholder="TC-001" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm text-slate-300 mb-1">Приоритет</label>
                                        <select id="test-priority" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                            <option value="high">Высокий</option>
                                            <option value="medium">Средний</option>
                                            <option value="low">Низкий</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm text-slate-300 mb-1">Название</label>
                                    <input type="text" id="test-title" placeholder="Название тест-кейса" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm text-slate-300 mb-1">Связанное требование</label>
                                    <select id="test-requirement" class="w-full p-2 bg-slate-800 border border-slate-700 rounded-lg">
                                        <option value="">Выберите требование</option>
                                    </select>
                                </div>
                                
                                <!-- Предусловия -->
                                <div class="mb-4">
                                    <label class="block text-sm text-slate-300 mb-1">Предусловия</label>
                                    <textarea id="test-preconditions" class="w-full h-20 p-2 bg-slate-800 border border-slate-700 rounded-lg" placeholder="Что должно быть выполнено перед тестом"></textarea>
                                </div>
                                
                                <!-- Шаги -->
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="block text-sm text-slate-300">Шаги тестирования</label>
                                        <button id="add-test-step" class="flex items-center gap-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition text-sm">
                                            <i data-lucide="plus" class="w-3 h-3"></i> Добавить шаг
                                        </button>
                                    </div>
                                    <div id="test-steps-list"></div>
                                </div>
                                
                                <!-- Ожидаемый результат -->
                                <div>
                                    <label class="block text-sm text-slate-300 mb-1">Ожидаемый результат</label>
                                    <textarea id="test-expected" class="w-full h-20 p-2 bg-slate-800 border border-slate-700 rounded-lg" placeholder="Что должно произойти"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Инструменты -->
            <div id="tools" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- JSON инструменты -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="code" class="w-5 h-5"></i> JSON инструменты
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">Валидатор JSON</h3>
                                <textarea id="json-input" class="w-full h-40 p-3 bg-slate-800 border border-slate-700 rounded-lg code-block" placeholder='{"key": "value"}'></textarea>
                                <div class="flex gap-2 mt-2">
                                    <button id="validate-json" class="flex-1 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                        Проверить
                                    </button>
                                    <button id="format-json" class="flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        Форматировать
                                    </button>
                                    <button id="minify-json" class="flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        Минифицировать
                                    </button>
                                </div>
                                <div id="json-result" class="mt-3 hidden p-3 rounded-lg"></div>
                            </div>
                            
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">Конвертер JSON → YAML</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm text-slate-400">JSON</label>
                                        <textarea id="json-to-yaml" class="w-full h-32 p-2 bg-slate-800 border border-slate-700 rounded-lg code-block"></textarea>
                                    </div>
                                    <div>
                                        <label class="text-sm text-slate-400">YAML</label>
                                        <textarea id="yaml-output" class="w-full h-32 p-2 bg-slate-800 border border-slate-700 rounded-lg code-block" readonly></textarea>
                                    </div>
                                </div>
                                <button id="convert-json-yaml" class="w-full mt-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                    Конвертировать
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Текстовые инструменты -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="type" class="w-5 h-5"></i> Текстовые инструменты
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">Конвертер регистров</h3>
                                <input type="text" id="case-input" class="w-full p-3 bg-slate-800 border border-slate-700 rounded-lg" placeholder="Введите текст..." value="user_first_name">
                                <div class="grid grid-cols-2 gap-2 mt-3">
                                    <button data-case="camel" class="p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        camelCase
                                    </button>
                                    <button data-case="pascal" class="p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        PascalCase
                                    </button>
                                    <button data-case="snake" class="p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        snake_case
                                    </button>
                                    <button data-case="kebab" class="p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        kebab-case
                                    </button>
                                </div>
                                <div class="mt-3">
                                    <label class="text-sm text-slate-400">Результат:</label>
                                    <div id="case-output" class="p-3 bg-slate-800 border border-slate-700 rounded-lg code-block"></div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">Генератор данных</h3>
                                <div class="flex gap-2">
                                    <button id="generate-email" class="flex-1 p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        Email
                                    </button>
                                    <button id="generate-phone" class="flex-1 p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        Телефон
                                    </button>
                                    <button id="generate-name" class="flex-1 p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        Имя
                                    </button>
                                </div>
                                <div id="generated-data" class="mt-2 p-3 bg-slate-800 border border-slate-700 rounded-lg code-block hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Справочник -->
            <div id="reference" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- HTTP Status Codes -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="globe" class="w-5 h-5"></i> HTTP Status Codes
                        </h2>
                        <div class="space-y-3">
                            <div class="p-3 rounded-lg bg-green-900/30 border border-green-800/50">
                                <div class="font-bold text-green-400">200 OK</div>
                                <div class="text-sm text-slate-300 mt-1">Запрос успешно выполнен</div>
                            </div>
                            <div class="p-3 rounded-lg bg-green-900/30 border border-green-800/50">
                                <div class="font-bold text-green-400">201 Created</div>
                                <div class="text-sm text-slate-300 mt-1">Ресурс успешно создан</div>
                            </div>
                            <div class="p-3 rounded-lg bg-yellow-900/30 border border-yellow-800/50">
                                <div class="font-bold text-yellow-400">400 Bad Request</div>
                                <div class="text-sm text-slate-300 mt-1">Некорректный запрос</div>
                            </div>
                            <div class="p-3 rounded-lg bg-yellow-900/30 border border-yellow-800/50">
                                <div class="font-bold text-yellow-400">401 Unauthorized</div>
                                <div class="text-sm text-slate-300 mt-1">Требуется аутентификация</div>
                            </div>
                            <div class="p-3 rounded-lg bg-yellow-900/30 border border-yellow-800/50">
                                <div class="font-bold text-yellow-400">403 Forbidden</div>
                                <div class="text-sm text-slate-300 mt-1">Доступ запрещен</div>
                            </div>
                            <div class="p-3 rounded-lg bg-yellow-900/30 border border-yellow-800/50">
                                <div class="font-bold text-yellow-400">404 Not Found</div>
                                <div class="text-sm text-slate-300 mt-1">Ресурс не найден</div>
                            </div>
                            <div class="p-3 rounded-lg bg-red-900/30 border border-red-800/50">
                                <div class="font-bold text-red-400">500 Internal Server Error</div>
                                <div class="text-sm text-slate-300 mt-1">Внутренняя ошибка сервера</div>
                            </div>
                        </div>
                    </div>

                    <!-- SQL Reference -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="database" class="w-5 h-5"></i> SQL Reference
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">JOIN Types</h3>
                                <div class="space-y-2">
                                    <div class="p-2 bg-slate-800 rounded">
                                        <div class="font-medium text-sky-400">INNER JOIN</div>
                                        <div class="text-sm text-slate-300">Только совпадающие строки</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded">
                                        <div class="font-medium text-sky-400">LEFT JOIN</div>
                                        <div class="text-sm text-slate-300">Все строки из левой таблицы</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded">
                                        <div class="font-medium text-sky-400">RIGHT JOIN</div>
                                        <div class="text-sm text-slate-300">Все строки из правой таблицы</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded">
                                        <div class="font-medium text-sky-400">FULL OUTER JOIN</div>
                                        <div class="text-sm text-slate-300">Все строки из обеих таблиц</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">Normal Forms</h3>
                                <div class="space-y-2">
                                    <div class="p-2 bg-slate-800 rounded">
                                        <div class="font-medium text-sky-400">1NF</div>
                                        <div class="text-sm text-slate-300">Атомарные значения, нет повторяющихся групп</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded">
                                        <div class="font-medium text-sky-400">2NF</div>
                                        <div class="text-sm text-slate-300">Нет частичных зависимостей</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded">
                                        <div class="font-medium text-sky-400">3NF</div>
                                        <div class="text-sm text-slate-300">Нет транзитивных зависимостей</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- UML Reference -->
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-sky-400 mb-4 flex items-center gap-2">
                            <i data-lucide="git-branch" class="w-5 h-5"></i> UML Reference
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">Диаграммы</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="p-2 bg-slate-800 rounded text-center">
                                        <div class="text-sm font-medium">Use Case</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded text-center">
                                        <div class="text-sm font-medium">Class</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded text-center">
                                        <div class="text-sm font-medium">Sequence</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded text-center">
                                        <div class="text-sm font-medium">Activity</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded text-center">
                                        <div class="text-sm font-medium">State</div>
                                    </div>
                                    <div class="p-2 bg-slate-800 rounded text-center">
                                        <div class="text-sm font-medium">Component</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="font-medium text-slate-300 mb-2">Отношения</h3>
                                <div class="space-y-2">
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 text-center">→</div>
                                        <div class="text-sm">Ассоциация</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 text-center">⟷</div>
                                        <div class="text-sm">Двусторонняя ассоциация</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 text-center">⭢</div>
                                        <div class="text-sm">Наследование</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 text-center">⟶</div>
                                        <div class="text-sm">Зависимость</div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 text-center">⟶</div>
                                        <div class="text-sm">Реализация</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quality Gate -->
            <div id="checklists" class="tab-content hidden">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-sky-400 flex items-center gap-2">
                            <i data-lucide="check-circle" class="w-5 h-5"></i> Quality Gate - Контроль качества
                        </h2>
                        <div class="flex gap-2">
                            <button id="save-checklists" class="flex items-center gap-2 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition">
                                <i data-lucide="save" class="w-4 h-4"></i> Сохранить все
                            </button>
                            <button id="generate-report" class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition">
                                <i data-lucide="file-text" class="w-4 h-4"></i> Отчет
                            </button>
                        </div>
                    </div>
                    
                    <!-- Общий прогресс -->
                    <div class="mb-8">
                        <div class="flex justify-between mb-2">
                            <span class="text-slate-300">Общий прогресс качества</span>
                            <span id="checklist-progress" class="text-sky-400 font-bold">0%</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-3">
                            <div id="progress-bar" class="bg-sky-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Чек-листы -->
                    <div class="space-y-8">
                        <!-- Анализ требований -->
                        <div>
                            <h3 class="text-lg font-bold text-slate-300 mb-4 flex items-center gap-2">
                                <i data-lucide="search" class="w-5 h-5"></i> Анализ требований
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="analysis" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Все требования понятны и однозначны</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="analysis" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Определены все граничные значения</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="analysis" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Учтены все сценарии использования</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="analysis" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Выявлены все заинтересованные стороны</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Проектирование -->
                        <div>
                            <h3 class="text-lg font-bold text-slate-300 mb-4 flex items-center gap-2">
                                <i data-lucide="layout" class="w-5 h-5"></i> Проектирование системы
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="design" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Архитектура системы определена</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="design" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Модель данных согласована</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="design" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">API спецификации готовы</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="design" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Определены нефункциональные требования</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Качество документации -->
                        <div>
                            <h3 class="text-lg font-bold text-slate-300 mb-4 flex items-center gap-2">
                                <i data-lucide="file-text" class="w-5 h-5"></i> Качество документации
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="documentation" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Документация полная и актуальная</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="documentation" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Есть примеры использования</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="documentation" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Документация соответствует стандартам</span>
                                </label>
                                <label class="checkbox-item flex items-center gap-3 p-3 rounded-lg bg-slate-800 hover:bg-slate-750 cursor-pointer">
                                    <input type="checkbox" data-category="documentation" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-sky-600 focus:ring-offset-slate-800">
                                    <span class="text-slate-200">Есть глоссарий терминов</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Футер -->
        <footer class="mt-12 pt-8 border-t border-slate-700 text-center text-slate-400 text-sm">
            <p>SA Toolkit Pro v2.0 | Полнофункциональная рабочая станция системного аналитика</p>
            <p class="mt-2">Автосохранение: <span id="last-save">не активно</span> | Проект: <span id="project-name">Новый проект</span></p>
        </footer>
    </div>

    <!-- Модальные окна -->
    <div id="modal-container"></div>

    <!-- Уведомления -->
    <div id="notification" class="fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm hidden">
        <div class="flex items-start gap-3">
            <i data-lucide="check-circle" id="notification-icon" class="w-5 h-5 mt-0.5 flex-shrink-0"></i>
            <div>
                <p id="notification-text" class="text-sm"></p>
            </div>
        </div>
    </div>

    <!-- Скрипты -->
    <script>
        // Глобальные переменные
        let currentProject = {
            name: 'Новый проект',
            requirements: [],
            diagrams: [],
            testCases: [],
            processes: [],
            models: [],
            apiEndpoints: [],
            traceability: {},
            checklists: {},
            analytics: {}
        };

        // Шаблоны документов
        const templates = {
            // Анализ
            'user-story': {
                category: 'analysis',
                name: 'User Story',
                content: `Как: [Роль пользователя]
Хочу: [Цель пользователя]
Чтобы: [Бизнес-выгода]

Критерии приемки:
1. [Критерий 1]
2. [Критерий 2]
3. [Критерий 3]

Примечания:
- [Дополнительная информация]`
            },
            
            'use-case': {
                category: 'analysis',
                name: 'Use Case',
                content: `Название: [Название Use Case]
ID: UC-[ID]

Акторы:
- Основной: [Основной актор]
- Второстепенные: [Второстепенные акторы]

Описание:
[Краткое описание Use Case]

Предусловия:
1. [Условие 1]
2. [Условие 2]

Основной поток:
1. [Шаг 1]
2. [Шаг 2]
3. [Шаг 3]

Альтернативные потоки:
A1: [Альтернативный поток 1]
A2: [Альтернативный поток 2]

Постусловия:
1. [Постусловие 1]
2. [Постусловие 2]

Исключения:
E1: [Исключение 1]
E2: [Исключение 2]`
            },
            
            'business-requirements': {
                category: 'analysis',
                name: 'Бизнес-требования',
                content: `Бизнес-требование: [Название]
ID: BR-[ID]

Бизнес-цель:
[Описание бизнес-цели]

Заинтересованные стороны:
- [Стейкхолдер 1]: [Роль/Интересы]
- [Стейкхолдер 2]: [Роль/Интересы]

Бизнес-правила:
1. [Правило 1]
2. [Правило 2]

Метрики успеха:
- [Метрика 1]: [Целевое значение]
- [Метрика 2]: [Целевое значение]

Ограничения:
- [Ограничение 1]
- [Ограничение 2]`
            },
            
            // Проектирование
            'api-endpoint': {
                category: 'design',
                name: 'API Endpoint',
                content: `Endpoint: [Метод] [Путь]
Версия: v[версия]
Описание: [Описание endpoint]

Заголовки запроса:
- Content-Type: application/json
- Authorization: Bearer {token}
- [Дополнительные заголовки]

Параметры пути:
- [Параметр 1]: [Описание]
- [Параметр 2]: [Описание]

Параметры запроса:
- [Параметр 1] (опционально): [Тип] - [Описание]
- [Параметр 2] (обязательно): [Тип] - [Описание]

Тело запроса:
\`\`\`json
{
  "field1": "value1",
  "field2": "value2"
}
\`\`\`

Ответы:
200 OK:
\`\`\`json
{
  "success": true,
  "data": { ... }
}
\`\`\`

400 Bad Request:
\`\`\`json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Описание ошибки"
  }
}
\`\`\`

401 Unauthorized:
\`\`\`json
{
  "success": false,
  "error": {
    "code": "UNAUTHENTICATED",
    "message": "Требуется аутентификация"
  }
}
\`\`\`

500 Internal Server Error:
\`\`\`json
{
  "success": false,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "Внутренняя ошибка сервера"
  }
}
\`\`\``
            },
            
            'data-model': {
                category: 'design',
                name: 'Модель данных',
                content: `Сущность: [Название сущности]
Описание: [Описание сущности]

Атрибуты:
| Поле | Тип | Обязательно | Описание | Пример |
|------|-----|-------------|----------|--------|
| id | integer | Да | Уникальный идентификатор | 123 |
| [поле] | [тип] | [да/нет] | [описание] | [пример] |

Связи:
- [Тип связи] с [Сущность]: [Описание связи]

Ограничения:
- [Ограничение 1]
- [Ограничение 2]

Индексы:
- [Индекс 1]
- [Индекс 2]`
            },
            
            // Тестирование
            'test-case': {
                category: 'testing',
                name: 'Тест-кейс',
                content: `Тест-кейс: [Название тест-кейса]
ID: TC-[ID]
Приоритет: [Высокий/Средний/Низкий]

Связанное требование: [ID требования]

Предусловия:
1. [Предусловие 1]
2. [Предусловие 2]

Шаги тестирования:
| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | [Действие 1] | [Результат 1] |
| 2 | [Действие 2] | [Результат 2] |
| 3 | [Действие 3] | [Результат 3] |

Постусловия:
1. [Постусловие 1]
2. [Постусловие 2]

Тестовые данные:
- [Данные 1]
- [Данные 2]

Примечания:
[Дополнительные заметки]`
            },
            
            'test-plan': {
                category: 'testing',
                name: 'План тестирования',
                content: `План тестирования: [Название функционала]
Версия: 1.0

Цели тестирования:
1. [Цель 1]
2. [Цель 2]

Объем тестирования:
- Включает: [Что тестируется]
- Не включает: [Что не тестируется]

Подход к тестированию:
[Описание подхода]

Критерии начала тестирования:
1. [Критерий 1]
2. [Критерий 2]

Критерии окончания тестирования:
1. [Критерий 1]
2. [Критерий 2]

Ресурсы:
- Тестовое окружение: [Описание]
- Тестовые данные: [Описание]
- Инструменты: [Список инструментов]

Расписание:
[Сроки тестирования]

Ответственные:
- [Роль]: [Имя]
- [Роль]: [Имя]`
            },
            
            // Управление
            'project-charter': {
                category: 'management',
                name: 'Устав проекта',
                content: `Устав проекта: [Название проекта]
                
Цели проекта:
1. [Цель 1]
2. [Цель 2]

Объем проекта:
- Включает: [Что входит]
- Не включает: [Что не входит]

Ключевые результаты:
1. [Результат 1]
2. [Результат 2]

Заинтересованные стороны:
| Роль | Имя | Ответственность |
|------|-----|-----------------|
| [Роль] | [Имя] | [Ответственность] |
| [Роль] | [Имя] | [Ответственность] |

Ограничения:
- Бюджет: [Сумма]
- Сроки: [Дата завершения]
- Ресурсы: [Ограничения]

Предположения:
1. [Предположение 1]
2. [Предположение 2]

Риски:
| Риск | Вероятность | Влияние | Стратегия реагирования |
|------|-------------|---------|------------------------|
| [Риск 1] | [Высокая/Средняя/Низкая] | [Высокое/Среднее/Низкое] | [Стратегия] |
| [Риск 2] | [Высокая/Средняя/Низкая] | [Высокое/Среднее/Низкое] | [Стратегия] |

Критерии приемки:
1. [Критерий 1]
2. [Критерий 2]`
            },
            
            'stakeholder-analysis': {
                category: 'management',
                name: 'Анализ заинтересованных сторон',
                content: `Анализ заинтересованных сторон проекта: [Название проекта]
                
| Заинтересованная сторона | Роль | Влияние | Интерес | Ожидания | Стратегия взаимодействия |
|--------------------------|------|---------|---------|----------|--------------------------|
| [Сторона 1] | [Роль] | [Высокое/Среднее/Низкое] | [Высокий/Средний/Низкий] | [Ожидания] | [Стратегия] |
| [Сторона 2] | [Роль] | [Высокое/Среднее/Низкое] | [Высокий/Средний/Низкий] | [Ожидания] | [Стратегия] |

Карта влияния/интереса:
- Высокое влияние, Высокий интерес: [Список]
- Высокое влияние, Низкий интерес: [Список]
- Низкое влияние, Высокий интерес: [Список]
- Низкое влияние, Низкий интерес: [Список]

План коммуникации:
| Аудитория | Канал | Частота | Ответственный | Цель |
|-----------|-------|---------|---------------|------|
| [Аудитория] | [Канал] | [Частота] | [Ответственный] | [Цель] |
| [Аудитория] | [Канал] | [Частота] | [Ответственный] | [Цель] |`
            }
        };

        // Примеры Mermaid диаграмм
        const mermaidExamples = {
            'flowchart': `graph TD
    A[Начало] --> B{Решение?}
    B -->|Да| C[Выполнить действие]
    B -->|Нет| D[Пропустить]
    C --> E[Завершение]
    D --> E
    
    style A fill:#38bdf8
    style E fill:#10b981`,
            
            'sequence': `sequenceDiagram
    participant Клиент
    participant Сервер
    participant БД
    
    Клиент->>Сервер: Запрос данных
    Сервер->>БД: SQL запрос
    БД-->>Сервер: Результат
    Сервер-->>Клиент: Ответ
    
    Note right of Клиент: Асинхронный<br/>запрос`,
            
            'class': `classDiagram
    class User {
        +int id
        +string name
        +string email
        +datetime createdAt
        +updateProfile()
        +deleteAccount()
    }
    
    class Order {
        +int id
        +decimal total
        +string status
        +addItem()
        +processPayment()
    }
    
    User "1" -- "*" Order : places`,
            
            'state': `stateDiagram-v2
    [*] --> Draft
    Draft --> UnderReview : Submit
    UnderReview --> Approved : Approve
    UnderReview --> Rejected : Reject
    UnderReview --> ChangesRequested : Request Changes
    ChangesRequested --> UnderReview : Resubmit
    Approved --> Implemented : Implement
    Implemented --> [*]
    Rejected --> [*]`,
            
            'er': `erDiagram
    CUSTOMER ||--o{ ORDER : places
    ORDER ||--|{ ORDER_LINE : contains
    PRODUCT ||--o{ ORDER_LINE : includes
    CUSTOMER {
        string customerId PK
        string firstName
        string lastName
        string email
        string phone
    }
    ORDER {
        string orderId PK
        date orderDate
        decimal totalAmount
        string status
    }
    PRODUCT {
        string productId PK
        string name
        decimal price
        int stockQuantity
    }`
        };

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация иконок
            if (window.lucide && window.lucide.createIcons) {
                lucide.createIcons();
            }
            
            // Инициализация Mermaid
            if (window.mermaid) {
                mermaid.initialize({
                    startOnLoad: false,
                    theme: 'default',
                    flowchart: { useMaxWidth: false },
                    securityLevel: 'loose'
                });
            }
            
            // Инициализация состояния приложения
            initializeApp();
            
            // Настройка обработчиков событий
            setupEventListeners();
            
            // Загрузка начальных данных
            loadSampleData();
            
            // Обновление статистики
            updateDashboardStats();
            
            // Показываем дашборд по умолчанию
            showTab('dashboard');
            
            console.log('Приложение инициализировано');
        });

        // Основные функции приложения
        function initializeApp() {
            // Загрузка данных из localStorage
            loadFromLocalStorage();
            
            // Инициализация интерфейса
            initializeUI();
        }

        function initializeUI() {
            // Инициализация шаблонов
            renderTemplatesGrid();
            
            // Инициализация диаграмм
            renderDiagramsList();
            
            // Инициализация требований
            renderRequirementsList();
            
            // Инициализация тест-кейсов
            renderTestCasesList();
            
            // Инициализация матрицы трассируемости
            renderTraceabilityMatrix();
            
            // Инициализация чек-листов
            initializeChecklists();
            
            // Инициализация графика
            initializeProjectChart();
        }

        function setupEventListeners() {
            // Навигация по вкладкам
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    showTab(tabId);
                });
            });
            
            // Шаблоны
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterTemplates(category);
                });
            });
            
            // Кнопки шаблонов
            const addTemplateBtn = document.getElementById('add-custom-template');
            if (addTemplateBtn) addTemplateBtn.addEventListener('click', addCustomTemplate);
            
            const saveTemplateBtn = document.getElementById('save-template');
            if (saveTemplateBtn) saveTemplateBtn.addEventListener('click', saveTemplate);
            
            const copyTemplateBtn = document.getElementById('copy-template');
            if (copyTemplateBtn) copyTemplateBtn.addEventListener('click', copyTemplate);
            
            const clearTemplateBtn = document.getElementById('clear-template');
            if (clearTemplateBtn) clearTemplateBtn.addEventListener('click', clearTemplate);
            
            const exportTemplateBtn = document.getElementById('export-template');
            if (exportTemplateBtn) exportTemplateBtn.addEventListener('click', exportTemplate);
            
            // Диаграммы
            const newDiagramBtn = document.getElementById('new-diagram');
            if (newDiagramBtn) newDiagramBtn.addEventListener('click', createNewDiagram);
            
            const saveDiagramBtn = document.getElementById('save-diagram');
            if (saveDiagramBtn) saveDiagramBtn.addEventListener('click', saveDiagram);
            
            const renderDiagramBtn = document.getElementById('render-diagram');
            if (renderDiagramBtn) renderDiagramBtn.addEventListener('click', renderDiagram);
            
            const exportDiagramsBtn = document.getElementById('export-diagrams');
            if (exportDiagramsBtn) exportDiagramsBtn.addEventListener('click', exportAllDiagrams);
            
            const exportPngBtn = document.getElementById('export-png');
            if (exportPngBtn) exportPngBtn.addEventListener('click', exportDiagramAsPNG);
            
            document.querySelectorAll('[data-example]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const example = this.getAttribute('data-example');
                    loadMermaidExample(example);
                });
            });
            
            // Требования
            const addRequirementBtn = document.getElementById('add-requirement');
            if (addRequirementBtn) addRequirementBtn.addEventListener('click', addRequirement);
            
            const importReqBtn = document.getElementById('import-req');
            if (importReqBtn) importReqBtn.addEventListener('click', importRequirements);
            
            const exportReqBtn = document.getElementById('export-req');
            if (exportReqBtn) exportReqBtn.addEventListener('click', exportRequirements);
            
            // Тестирование
            const newTestCaseBtn = document.getElementById('new-test-case');
            if (newTestCaseBtn) newTestCaseBtn.addEventListener('click', addTestCase);
            
            const generateTestsBtn = document.getElementById('generate-tests');
            if (generateTestsBtn) generateTestsBtn.addEventListener('click', generateTestsFromRequirements);
            
            const addTestStepBtn = document.getElementById('add-test-step');
            if (addTestStepBtn) addTestStepBtn.addEventListener('click', addTestStep);
            
            // Инструменты
            const validateJsonBtn = document.getElementById('validate-json');
            if (validateJsonBtn) validateJsonBtn.addEventListener('click', validateJSON);
            
            const formatJsonBtn = document.getElementById('format-json');
            if (formatJsonBtn) formatJsonBtn.addEventListener('click', formatJSON);
            
            const minifyJsonBtn = document.getElementById('minify-json');
            if (minifyJsonBtn) minifyJsonBtn.addEventListener('click', minifyJSON);
            
            const convertJsonYamlBtn = document.getElementById('convert-json-yaml');
            if (convertJsonYamlBtn) convertJsonYamlBtn.addEventListener('click', convertJsonToYaml);
            
            document.querySelectorAll('[data-case]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const caseType = this.getAttribute('data-case');
                    convertCase(caseType);
                });
            });
            
            const generateEmailBtn = document.getElementById('generate-email');
            if (generateEmailBtn) generateEmailBtn.addEventListener('click', generateEmail);
            
            const generatePhoneBtn = document.getElementById('generate-phone');
            if (generatePhoneBtn) generatePhoneBtn.addEventListener('click', generatePhone);
            
            const generateNameBtn = document.getElementById('generate-name');
            if (generateNameBtn) generateNameBtn.addEventListener('click', generateName);
            
            // Чек-листы
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateChecklistProgress);
            });
            
            const saveChecklistsBtn = document.getElementById('save-checklists');
            if (saveChecklistsBtn) saveChecklistsBtn.addEventListener('click', saveAllChecklists);
            
            const generateReportBtn = document.getElementById('generate-report');
            if (generateReportBtn) generateReportBtn.addEventListener('click', generateQualityReport);
            
            // Управление проектом
            const newProjectBtn = document.getElementById('new-project');
            if (newProjectBtn) newProjectBtn.addEventListener('click', createNewProject);
            
            const exportAllBtn = document.getElementById('export-all');
            if (exportAllBtn) exportAllBtn.addEventListener('click', exportAllData);
            
            const importAllBtn = document.getElementById('import-all');
            if (importAllBtn) importAllBtn.addEventListener('click', importAllData);
            
            const settingsBtn = document.getElementById('settings');
            if (settingsBtn) settingsBtn.addEventListener('click', showSettings);
            
            const addTaskBtn = document.getElementById('add-task');
            if (addTaskBtn) addTaskBtn.addEventListener('click', addTask);
            
            // API
            const newEndpointBtn = document.getElementById('new-endpoint');
            if (newEndpointBtn) newEndpointBtn.addEventListener('click', addApiEndpoint);
            
            const importSwaggerBtn = document.getElementById('import-swagger');
            if (importSwaggerBtn) importSwaggerBtn.addEventListener('click', importSwagger);
            
            const exportOpenapiBtn = document.getElementById('export-openapi');
            if (exportOpenapiBtn) exportOpenapiBtn.addEventListener('click', exportOpenAPI);
            
            // Процессы
            const newProcessBtn = document.getElementById('new-process');
            if (newProcessBtn) newProcessBtn.addEventListener('click', addProcess);
            
            const analyzeProcessBtn = document.getElementById('analyze-process');
            if (analyzeProcessBtn) analyzeProcessBtn.addEventListener('click', analyzeProcess);
            
            // Модели данных
            const newModelBtn = document.getElementById('new-model');
            if (newModelBtn) newModelBtn.addEventListener('click', addDataModel);
            
            const generateSqlBtn = document.getElementById('generate-sql');
            if (generateSqlBtn) generateSqlBtn.addEventListener('click', generateSQL);
            
            // Трассируемость
            const autoTraceBtn = document.getElementById('auto-trace');
            if (autoTraceBtn) autoTraceBtn.addEventListener('click', autoTraceRequirements);
            
            const exportTraceBtn = document.getElementById('export-trace');
            if (exportTraceBtn) exportTraceBtn.addEventListener('click', exportTraceabilityMatrix);
            
            // Обработчик для редактора шаблонов
            const templateEditor = document.getElementById('template-editor');
            if (templateEditor) {
                templateEditor.addEventListener('input', updateTemplateCharCount);
            }
            
            // Обработчик для редактора диаграмм
            const mermaidEditor = document.getElementById('mermaid-editor');
            if (mermaidEditor) {
                mermaidEditor.addEventListener('input', function() {
                    clearTimeout(window.diagramSaveTimeout);
                    window.diagramSaveTimeout = setTimeout(() => {
                        renderDiagram();
                    }, 1000);
                });
            }
            
            console.log('Обработчики событий установлены');
        }

        // Функции для работы с вкладками
        function showTab(tabId) {
            // Скрыть все вкладки
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Показать выбранную вкладку
            const tabElement = document.getElementById(tabId);
            if (tabElement) {
                tabElement.classList.remove('hidden');
                
                // Обновить активную кнопку
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('tab-active');
                });
                
                const activeBtn = document.querySelector(`[data-tab="${tabId}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('tab-active');
                }
                
                // Специальная обработка для некоторых вкладок
                if (tabId === 'diagrams') {
                    setTimeout(renderDiagram, 100);
                } else if (tabId === 'dashboard') {
                    updateDashboardStats();
                }
            }
            
            // Сохранить активную вкладку
            localStorage.setItem('activeTab', tabId);
        }

        // Загрузка примера данных
        function loadSampleData() {
            // Если нет сохраненных данных, загружаем примеры
            if (!localStorage.getItem('saToolkitProject')) {
                currentProject.requirements = [
                    {
                        id: 'REQ-001',
                        title: 'Система должна позволять пользователям регистрироваться',
                        description: 'Пользователи могут создать учетную запись с email и паролем',
                        type: 'functional',
                        priority: 'high',
                        status: 'approved',
                        date: '2024-01-15',
                        moscow: 'must'
                    },
                    {
                        id: 'REQ-002',
                        title: 'Время ответа системы не должно превышать 2 секунд',
                        description: '95% запросов должны обрабатываться менее чем за 2 секунды',
                        type: 'non-functional',
                        priority: 'high',
                        status: 'review',
                        date: '2024-01-16',
                        moscow: 'must'
                    },
                    {
                        id: 'REQ-003',
                        title: 'Поддержка темной темы интерфейса',
                        description: 'Пользователи могут переключаться между светлой и темной темой',
                        type: 'functional',
                        priority: 'medium',
                        status: 'draft',
                        date: '2024-01-17',
                        moscow: 'should'
                    }
                ];
                
                currentProject.diagrams = [
                    {
                        id: 'DIA-001',
                        title: 'Диаграмма регистрации пользователя',
                        type: 'flowchart',
                        code: mermaidExamples.flowchart,
                        date: '2024-01-15'
                    }
                ];
                
                currentProject.testCases = [
                    {
                        id: 'TC-001',
                        title: 'Тестирование регистрации пользователя',
                        requirementId: 'REQ-001',
                        priority: 'high',
                        status: 'draft',
                        date: '2024-01-16'
                    }
                ];
                
                saveToLocalStorage();
            }
        }

        // Шаблоны
        function renderTemplatesGrid() {
            const grid = document.getElementById('templates-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            for (const [key, template] of Object.entries(templates)) {
                const templateCard = document.createElement('div');
                templateCard.className = 'card p-4 cursor-pointer hover:border-sky-500 transition';
                templateCard.innerHTML = `
                    <div class="font-medium text-slate-200">${template.name}</div>
                    <div class="text-xs text-slate-400 mt-1">${template.category === 'analysis' ? 'Анализ' : 
                                                        template.category === 'design' ? 'Проектирование' :
                                                        template.category === 'testing' ? 'Тестирование' :
                                                        template.category === 'management' ? 'Управление' : 'API'}</div>
                    <div class="text-xs text-slate-500 mt-2 truncate">${template.content.substring(0, 60)}...</div>
                `;
                
                templateCard.addEventListener('click', () => loadTemplate(key));
                grid.appendChild(templateCard);
            }
        }

        function loadTemplate(templateId) {
            if (templates[templateId]) {
                const editor = document.getElementById('template-editor');
                if (editor) {
                    editor.value = templates[templateId].content;
                    updateTemplateCharCount();
                }
            }
        }

        function filterTemplates(category) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.className = 'category-btn w-full text-left p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition';
            });
            
            const activeBtn = document.querySelector(`[data-category="${category}"]`);
            if (activeBtn) {
                activeBtn.className = 'category-btn w-full text-left p-3 rounded-lg bg-sky-600 text-white';
            }
            
            // Здесь можно реализовать фильтрацию шаблонов по категории
            showNotification(`Фильтр: ${category === 'all' ? 'Все шаблоны' : category}`, 'info');
        }

        function addCustomTemplate() {
            showNotification('Функция добавления пользовательских шаблонов в разработке', 'info');
        }

        function saveTemplate() {
            const editor = document.getElementById('template-editor');
            if (!editor) return;
            
            const content = editor.value;
            localStorage.setItem('currentTemplate', content);
            showNotification('Шаблон сохранен', 'success');
            updateLastSaveTime();
        }

        function copyTemplate() {
            const editor = document.getElementById('template-editor');
            if (!editor) return;
            
            const content = editor.value;
            navigator.clipboard.writeText(content)
                .then(() => showNotification('Шаблон скопирован в буфер обмена', 'success'))
                .catch(err => showNotification('Ошибка копирования: ' + err, 'error'));
        }

        function clearTemplate() {
            const editor = document.getElementById('template-editor');
            if (!editor) return;
            
            if (confirm('Очистить редактор шаблонов?')) {
                editor.value = '';
                showNotification('Редактор очищен', 'info');
            }
        }

        function exportTemplate() {
            const editor = document.getElementById('template-editor');
            if (!editor) return;
            
            const content = editor.value;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'template.txt';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Шаблон экспортирован', 'success');
        }

        function updateTemplateCharCount() {
            const editor = document.getElementById('template-editor');
            if (!editor) return;
            
            const content = editor.value;
            const charCount = document.getElementById('template-char-count');
            if (charCount) {
                charCount.textContent = `${content.length} символов`;
            }
        }

        // Диаграммы
        function renderDiagramsList() {
            const list = document.getElementById('diagrams-list');
            if (!list) return;
            
            list.innerHTML = '';
            
            currentProject.diagrams.forEach(diagram => {
                const diagramCard = document.createElement('div');
                diagramCard.className = 'card p-4 cursor-pointer hover:border-sky-500 transition';
                diagramCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-medium text-slate-200">${diagram.title}</div>
                            <div class="text-xs text-slate-400 mt-1">${diagram.type}</div>
                        </div>
                        <button class="delete-diagram text-slate-500 hover:text-red-400" data-id="${diagram.id}">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="text-xs text-slate-500 mt-2">${diagram.date}</div>
                `;
                
                diagramCard.addEventListener('click', () => loadDiagram(diagram.id));
                diagramCard.querySelector('.delete-diagram').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteDiagram(diagram.id);
                });
                
                list.appendChild(diagramCard);
            });
            
            // Обновить иконки
            if (window.lucide && window.lucide.createIcons) {
                lucide.createIcons();
            }
        }

        function createNewDiagram() {
            currentProject.diagrams.push({
                id: 'DIA-' + (currentProject.diagrams.length + 1).toString().padStart(3, '0'),
                title: 'Новая диаграмма',
                type: 'flowchart',
                code: mermaidExamples.flowchart,
                date: new Date().toISOString().split('T')[0]
            });
            
            renderDiagramsList();
            loadDiagram(currentProject.diagrams[currentProject.diagrams.length - 1].id);
            saveToLocalStorage();
            showNotification('Новая диаграмма создана', 'success');
        }

        function loadDiagram(diagramId) {
            const diagram = currentProject.diagrams.find(d => d.id === diagramId);
            if (diagram) {
                const editor = document.getElementById('mermaid-editor');
                const titleInput = document.getElementById('diagram-title');
                
                if (editor) editor.value = diagram.code;
                if (titleInput) titleInput.value = diagram.title;
                
                renderDiagram();
            }
        }

        function saveDiagram() {
            const titleInput = document.getElementById('diagram-title');
            const editor = document.getElementById('mermaid-editor');
            
            if (!titleInput || !editor) return;
            
            const title = titleInput.value || 'Без названия';
            const code = editor.value;
            
            // Обновляем текущую диаграмму или создаем новую
            const currentTitle = titleInput.value;
            const existingDiagram = currentProject.diagrams.find(d => d.title === currentTitle);
            
            if (existingDiagram) {
                existingDiagram.code = code;
                existingDiagram.title = title;
            } else {
                currentProject.diagrams.push({
                    id: 'DIA-' + (currentProject.diagrams.length + 1).toString().padStart(3, '0'),
                    title: title,
                    type: 'custom',
                    code: code,
                    date: new Date().toISOString().split('T')[0]
                });
            }
            
            renderDiagramsList();
            saveToLocalStorage();
            showNotification('Диаграмма сохранена', 'success');
        }

        function renderDiagram() {
            const editor = document.getElementById('mermaid-editor');
            const preview = document.getElementById('diagram-preview');
            
            if (!editor || !preview) return;
            
            const code = editor.value;
            
            if (!code.trim()) {
                preview.innerHTML = '<p class="text-slate-500 text-center">Диаграмма появится здесь</p>';
                return;
            }
            
            try {
                preview.innerHTML = '';
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = code;
                preview.appendChild(mermaidDiv);
                
                if (window.mermaid) {
                    mermaid.init({}, mermaidDiv);
                }
            } catch (error) {
                preview.innerHTML = `
                    <div class="p-4 text-red-400">
                        <div class="font-bold mb-2">Ошибка рендеринга:</div>
                        <div class="text-sm">${error.message}</div>
                    </div>
                `;
            }
        }

        function loadMermaidExample(example) {
            if (mermaidExamples[example]) {
                const editor = document.getElementById('mermaid-editor');
                if (editor) {
                    editor.value = mermaidExamples[example];
                    renderDiagram();
                    showNotification('Пример загружен', 'success');
                }
            }
        }

        function deleteDiagram(diagramId) {
            if (confirm('Удалить эту диаграмму?')) {
                currentProject.diagrams = currentProject.diagrams.filter(d => d.id !== diagramId);
                renderDiagramsList();
                saveToLocalStorage();
                showNotification('Диаграмма удалена', 'success');
            }
        }

        function exportAllDiagrams() {
            const data = JSON.stringify(currentProject.diagrams, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'diagrams-export.json';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Все диаграммы экспортированы', 'success');
        }

        function exportDiagramAsPNG() {
            showNotification('Экспорт PNG в разработке', 'info');
        }

        // Требования
        function renderRequirementsList() {
            const list = document.getElementById('requirements-list');
            if (!list) return;
            
            list.innerHTML = '';
            
            currentProject.requirements.forEach(req => {
                const row = document.createElement('tr');
                row.className = 'border-b border-slate-800 hover:bg-slate-800/50';
                row.innerHTML = `
                    <td class="py-3 px-4">
                        <span class="font-mono text-sky-400">${req.id}</span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="font-medium">${req.title}</div>
                        <div class="text-sm text-slate-400">${req.description.substring(0, 80)}...</div>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded text-xs ${
                            req.type === 'functional' ? 'bg-blue-900/50 text-blue-300' :
                            req.type === 'non-functional' ? 'bg-purple-900/50 text-purple-300' :
                            req.type === 'business' ? 'bg-emerald-900/50 text-emerald-300' :
                            'bg-amber-900/50 text-amber-300'
                        }">
                            ${req.type === 'functional' ? 'Функциональное' :
                              req.type === 'non-functional' ? 'Нефункциональное' :
                              req.type === 'business' ? 'Бизнес' : 'Пользовательское'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded text-xs ${
                            req.priority === 'high' ? 'bg-red-900/50 text-red-300' :
                            req.priority === 'medium' ? 'bg-amber-900/50 text-amber-300' :
                            'bg-emerald-900/50 text-emerald-300'
                        }">
                            ${req.priority === 'high' ? 'Высокий' :
                              req.priority === 'medium' ? 'Средний' : 'Низкий'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded text-xs ${
                            req.status === 'approved' ? 'bg-emerald-900/50 text-emerald-300' :
                            req.status === 'review' ? 'bg-amber-900/50 text-amber-300' :
                            req.status === 'rejected' ? 'bg-red-900/50 text-red-300' :
                            req.status === 'implemented' ? 'bg-blue-900/50 text-blue-300' :
                            'bg-slate-700 text-slate-300'
                        }">
                            ${req.status === 'approved' ? 'Утверждено' :
                              req.status === 'review' ? 'На рассмотрении' :
                              req.status === 'rejected' ? 'Отклонено' :
                              req.status === 'implemented' ? 'Реализовано' : 'Черновик'}
                        </span>
                    </td>
                    <td class="py-3 px-4 text-sm text-slate-400">${req.date}</td>
                    <td class="py-3 px-4">
                        <div class="flex gap-2">
                            <button class="edit-requirement text-sky-400 hover:text-sky-300" data-id="${req.id}">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button class="delete-requirement text-red-400 hover:text-red-300" data-id="${req.id}">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                list.appendChild(row);
            });
            
            // Обновить иконки
            if (window.lucide && window.lucide.createIcons) {
                lucide.createIcons();
            }
            
            // Навесить обработчики событий
            document.querySelectorAll('.edit-requirement').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reqId = this.getAttribute('data-id');
                    editRequirement(reqId);
                });
            });
            
            document.querySelectorAll('.delete-requirement').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reqId = this.getAttribute('data-id');
                    deleteRequirement(reqId);
                });
            });
            
            // Обновить MoSCoW списки
            updateMoSCoWLists();
        }

        function addRequirement() {
            const newId = 'REQ-' + (currentProject.requirements.length + 1).toString().padStart(3, '0');
            currentProject.requirements.push({
                id: newId,
                title: 'Новое требование',
                description: 'Описание требования',
                type: 'functional',
                priority: 'medium',
                status: 'draft',
                date: new Date().toISOString().split('T')[0],
                moscow: 'could'
            });
            
            renderRequirementsList();
            saveToLocalStorage();
            showNotification('Новое требование добавлено', 'success');
        }

        function editRequirement(reqId) {
            showNotification('Редактирование требования в разработке', 'info');
        }

        function deleteRequirement(reqId) {
            if (confirm('Удалить это требование?')) {
                currentProject.requirements = currentProject.requirements.filter(req => req.id !== reqId);
                renderRequirementsList();
                saveToLocalStorage();
                showNotification('Требование удалено', 'success');
            }
        }

        function updateMoSCoWLists() {
            const mustList = document.getElementById('must-have-list');
            const shouldList = document.getElementById('should-have-list');
            const couldList = document.getElementById('could-have-list');
            const wontList = document.getElementById('wont-have-list');
            
            if (!mustList || !shouldList || !couldList || !wontList) return;
            
            mustList.innerHTML = '';
            shouldList.innerHTML = '';
            couldList.innerHTML = '';
            wontList.innerHTML = '';
            
            currentProject.requirements.forEach(req => {
                const item = document.createElement('div');
                item.className = 'text-sm text-slate-300 p-2 bg-slate-800/50 rounded';
                item.textContent = `${req.id}: ${req.title}`;
                
                switch(req.moscow) {
                    case 'must':
                        mustList.appendChild(item);
                        break;
                    case 'should':
                        shouldList.appendChild(item);
                        break;
                    case 'could':
                        couldList.appendChild(item);
                        break;
                    case 'wont':
                        wontList.appendChild(item);
                        break;
                }
            });
        }

        // Тестирование
        function renderTestCasesList() {
            const list = document.getElementById('test-cases-list');
            if (!list) return;
            
            list.innerHTML = '';
            
            currentProject.testCases.forEach(test => {
                const testCard = document.createElement('div');
                testCard.className = 'card p-3 cursor-pointer hover:border-sky-500 transition';
                testCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-medium text-slate-200">${test.id}: ${test.title}</div>
                            <div class="text-xs text-slate-400 mt-1">Приоритет: ${
                                test.priority === 'high' ? 'Высокий' :
                                test.priority === 'medium' ? 'Средний' : 'Низкий'
                            }</div>
                        </div>
                        <span class="px-2 py-1 rounded text-xs ${
                            test.status === 'passed' ? 'bg-emerald-900/50 text-emerald-300' :
                            test.status === 'failed' ? 'bg-red-900/50 text-red-300' :
                            test.status === 'ready' ? 'bg-blue-900/50 text-blue-300' :
                            'bg-slate-700 text-slate-300'
                        }">
                            ${test.status === 'passed' ? 'Пройден' :
                              test.status === 'failed' ? 'Провален' :
                              test.status === 'ready' ? 'Готов' : 'Черновик'}
                        </span>
                    </div>
                    <div class="text-xs text-slate-500 mt-2">${test.date}</div>
                `;
                
                testCard.addEventListener('click', () => loadTestCase(test.id));
                list.appendChild(testCard);
            });
        }

        function addTestCase() {
            const newId = 'TC-' + (currentProject.testCases.length + 1).toString().padStart(3, '0');
            currentProject.testCases.push({
                id: newId,
                title: 'Новый тест-кейс',
                requirementId: '',
                priority: 'medium',
                status: 'draft',
                date: new Date().toISOString().split('T')[0]
            });
            
            renderTestCasesList();
            saveToLocalStorage();
            showNotification('Новый тест-кейс добавлен', 'success');
        }

        function loadTestCase(testId) {
            const test = currentProject.testCases.find(t => t.id === testId);
            if (test) {
                const testIdInput = document.getElementById('test-id');
                const testTitleInput = document.getElementById('test-title');
                const testPrioritySelect = document.getElementById('test-priority');
                
                if (testIdInput) testIdInput.value = test.id;
                if (testTitleInput) testTitleInput.value = test.title;
                if (testPrioritySelect) testPrioritySelect.value = test.priority;
                
                // Заполнить селектор требований
                const requirementSelect = document.getElementById('test-requirement');
                if (requirementSelect) {
                    requirementSelect.innerHTML = '<option value="">Выберите требование</option>';
                    currentProject.requirements.forEach(req => {
                        const option = document.createElement('option');
                        option.value = req.id;
                        option.textContent = `${req.id}: ${req.title}`;
                        if (req.id === test.requirementId) {
                            option.selected = true;
                        }
                        requirementSelect.appendChild(option);
                    });
                }
            }
        }

        function addTestStep() {
            const stepsList = document.getElementById('test-steps-list');
            if (!stepsList) return;
            
            const stepCount = stepsList.children.length + 1;
            
            const stepDiv = document.createElement('div');
            stepDiv.className = 'flex gap-2 mb-2';
            stepDiv.innerHTML = `
                <input type="text" placeholder="Шаг ${stepCount}" class="flex-1 p-2 bg-slate-800 border border-slate-700 rounded-lg">
                <input type="text" placeholder="Ожидаемый результат" class="flex-1 p-2 bg-slate-800 border border-slate-700 rounded-lg">
                <button class="remove-step px-2 text-red-400 hover:text-red-300">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            `;
            
            stepsList.appendChild(stepDiv);
            
            if (window.lucide && window.lucide.createIcons) {
                lucide.createIcons();
            }
            
            stepDiv.querySelector('.remove-step').addEventListener('click', function() {
                stepsList.removeChild(stepDiv);
            });
        }

        // Инструменты
        function validateJSON() {
            const input = document.getElementById('json-input');
            const resultDiv = document.getElementById('json-result');
            
            if (!input || !resultDiv) return;
            
            try {
                JSON.parse(input.value);
                resultDiv.className = 'mt-3 p-3 rounded-lg bg-emerald-900/30 border border-emerald-800/50';
                resultDiv.innerHTML = '<div class="text-emerald-400">✓ JSON валиден</div>';
                resultDiv.classList.remove('hidden');
                showNotification('JSON валиден', 'success');
            } catch (error) {
                resultDiv.className = 'mt-3 p-3 rounded-lg bg-red-900/30 border border-red-800/50';
                resultDiv.innerHTML = `<div class="text-red-400">✗ Ошибка JSON: ${error.message}</div>`;
                resultDiv.classList.remove('hidden');
                showNotification('Обнаружена ошибка в JSON', 'error');
            }
        }

        function formatJSON() {
            const input = document.getElementById('json-input');
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input.value);
                input.value = JSON.stringify(parsed, null, 2);
                showNotification('JSON отформатирован', 'success');
            } catch (error) {
                showNotification('Невозможно форматировать невалидный JSON', 'error');
            }
        }

        function minifyJSON() {
            const input = document.getElementById('json-input');
            if (!input) return;
            
            try {
                const parsed = JSON.parse(input.value);
                input.value = JSON.stringify(parsed);
                showNotification('JSON минифицирован', 'success');
            } catch (error) {
                showNotification('Невозможно минифицировать невалидный JSON', 'error');
            }
        }

        function convertJsonToYaml() {
            const jsonInput = document.getElementById('json-to-yaml');
            const yamlOutput = document.getElementById('yaml-output');
            
            if (!jsonInput || !yamlOutput) return;
            
            try {
                const obj = JSON.parse(jsonInput.value);
                const yaml = jsonToYaml(obj);
                yamlOutput.value = yaml;
                showNotification('JSON конвертирован в YAML', 'success');
            } catch (error) {
                yamlOutput.value = `Ошибка: ${error.message}`;
                showNotification('Ошибка конвертации', 'error');
            }
        }

        function jsonToYaml(obj, indent = 0) {
            let yaml = '';
            const spaces = '  '.repeat(indent);
            
            if (Array.isArray(obj)) {
                obj.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        yaml += spaces + '- ' + jsonToYaml(item, indent + 1).trim() + '\n';
                    } else {
                        yaml += spaces + '- ' + item + '\n';
                    }
                });
            } else if (typeof obj === 'object' && obj !== null) {
                Object.entries(obj).forEach(([key, value]) => {
                    if (typeof value === 'object' && value !== null) {
                        yaml += spaces + key + ':\n' + jsonToYaml(value, indent + 1);
                    } else {
                        yaml += spaces + key + ': ' + value + '\n';
                    }
                });
            }
            
            return yaml;
        }

        function convertCase(caseType) {
            const input = document.getElementById('case-input');
            const output = document.getElementById('case-output');
            
            if (!input || !output) return;
            
            const text = input.value;
            let result = '';
            
            switch(caseType) {
                case 'camel':
                    result = text.replace(/[^a-zA-Z0-9]+(.)/g, (_, chr) => chr.toUpperCase())
                                 .replace(/^[A-Z]/, first => first.toLowerCase());
                    break;
                case 'pascal':
                    result = text.replace(/[^a-zA-Z0-9]+(.)/g, (_, chr) => chr.toUpperCase())
                                 .replace(/^[a-z]/, first => first.toUpperCase());
                    break;
                case 'snake':
                    result = text.replace(/([a-z])([A-Z])/g, '$1_$2')
                                 .replace(/[^a-zA-Z0-9]+/g, '_')
                                 .toLowerCase();
                    break;
                case 'kebab':
                    result = text.replace(/([a-z])([A-Z])/g, '$1-$2')
                                 .replace(/[^a-zA-Z0-9]+/g, '-')
                                 .toLowerCase();
                    break;
            }
            
            output.textContent = result;
        }

        function generateEmail() {
            const domains = ['example.com', 'test.ru', 'demo.org', 'mail.com'];
            const domain = domains[Math.floor(Math.random() * domains.length)];
            const name = Math.random().toString(36).substring(2, 10);
            const email = `${name}@${domain}`;
            
            const output = document.getElementById('generated-data');
            if (output) {
                output.textContent = email;
                output.classList.remove('hidden');
            }
        }

        function generatePhone() {
            const phone = '+7 (' + Math.floor(Math.random() * 1000).toString().padStart(3, '0') + ') ' +
                         Math.floor(Math.random() * 1000).toString().padStart(3, '0') + '-' +
                         Math.floor(Math.random() * 100).toString().padStart(2, '0') + '-' +
                         Math.floor(Math.random() * 100).toString().padStart(2, '0');
            
            const output = document.getElementById('generated-data');
            if (output) {
                output.textContent = phone;
                output.classList.remove('hidden');
            }
        }

        function generateName() {
            const names = ['Иван', 'Алексей', 'Мария', 'Анна', 'Дмитрий', 'Екатерина'];
            const surnames = ['Иванов', 'Петров', 'Сидоров', 'Смирнов', 'Кузнецов'];
            const name = names[Math.floor(Math.random() * names.length)];
            const surname = surnames[Math.floor(Math.random() * surnames.length)];
            
            const output = document.getElementById('generated-data');
            if (output) {
                output.textContent = `${name} ${surname}`;
                output.classList.remove('hidden');
            }
        }

        // Чек-листы
        function initializeChecklists() {
            const saved = localStorage.getItem('checklists');
            if (saved) {
                try {
                    const checklists = JSON.parse(saved);
                    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                        const category = checkbox.getAttribute('data-category');
                        const text = checkbox.parentElement.querySelector('span').textContent;
                        
                        if (checklists[category] && checklists[category][text]) {
                            checkbox.checked = true;
                        }
                    });
                } catch (error) {
                    console.error('Ошибка загрузки чек-листов:', error);
                }
            }
            
            updateChecklistProgress();
        }

        function updateChecklistProgress() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;
            
            const progressText = document.getElementById('checklist-progress');
            const progressBar = document.getElementById('progress-bar');
            
            if (progressText) progressText.textContent = `${percentage}%`;
            if (progressBar) progressBar.style.width = `${percentage}%`;
        }

        function saveAllChecklists() {
            const checklists = {
                analysis: {},
                design: {},
                documentation: {}
            };
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                const category = checkbox.getAttribute('data-category');
                const text = checkbox.parentElement.querySelector('span').textContent;
                checklists[category][text] = checkbox.checked;
            });
            
            localStorage.setItem('checklists', JSON.stringify(checklists));
            showNotification('Чек-листы сохранены', 'success');
            updateLastSaveTime();
        }

        function generateQualityReport() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;
            
            let report = `Отчет о качестве проекта\n`;
            report += `Дата генерации: ${new Date().toLocaleDateString()}\n`;
            report += `Общий прогресс: ${percentage}%\n\n`;
            report += `Анализ требований:\n`;
            
            document.querySelectorAll('[data-category="analysis"]').forEach(cb => {
                const status = cb.checked ? '✓' : '✗';
                report += `${status} ${cb.parentElement.querySelector('span').textContent}\n`;
            });
            
            report += `\nПроектирование системы:\n`;
            document.querySelectorAll('[data-category="design"]').forEach(cb => {
                const status = cb.checked ? '✓' : '✗';
                report += `${status} ${cb.parentElement.querySelector('span').textContent}\n`;
            });
            
            report += `\nКачество документации:\n`;
            document.querySelectorAll('[data-category="documentation"]').forEach(cb => {
                const status = cb.checked ? '✓' : '✗';
                report += `${status} ${cb.parentElement.querySelector('span').textContent}\n`;
            });
            
            // Создаем и скачиваем отчет
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'quality-report.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Отчет о качестве сгенерирован', 'success');
        }

        // Управление проектом
        function createNewProject() {
            if (confirm('Создать новый проект? Текущие данные будут сохранены.')) {
                currentProject = {
                    name: 'Новый проект',
                    requirements: [],
                    diagrams: [],
                    testCases: [],
                    processes: [],
                    models: [],
                    apiEndpoints: [],
                    traceability: {},
                    checklists: {},
                    analytics: {}
                };
                
                const projectName = document.getElementById('project-name');
                const currentProjectSpan = document.getElementById('current-project');
                
                if (projectName) projectName.textContent = 'Новый проект';
                if (currentProjectSpan) currentProjectSpan.textContent = 'Проект: Новый проект';
                
                initializeUI();
                saveToLocalStorage();
                showNotification('Новый проект создан', 'success');
            }
        }

        function exportAllData() {
            const data = {
                project: currentProject,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sa-toolkit-project-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Все данные проекта экспортированы', 'success');
        }

        function importAllData() {
            showNotification('Импорт данных в разработке', 'info');
        }

        function showSettings() {
            showNotification('Настройки в разработке', 'info');
        }

        function addTask() {
            const task = prompt('Введите задачу:');
            if (task) {
                const tasksList = document.getElementById('upcoming-tasks');
                if (tasksList) {
                    const taskDiv = document.createElement('div');
                    taskDiv.className = 'flex items-center gap-3 p-3 bg-slate-800 rounded-lg';
                    taskDiv.innerHTML = `
                        <input type="checkbox" class="w-5 h-5 rounded border-slate-600 bg-slate-700 text-sky-500">
                        <span class="text-slate-300">${task}</span>
                        <button class="ml-auto text-slate-500 hover:text-red-400">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    `;
                    
                    tasksList.appendChild(taskDiv);
                    
                    if (window.lucide && window.lucide.createIcons) {
                        lucide.createIcons();
                    }
                    
                    taskDiv.querySelector('button').addEventListener('click', function() {
                        tasksList.removeChild(taskDiv);
                    });
                    
                    showNotification('Задача добавлена', 'success');
                }
            }
        }

        // Дашборд
        function updateDashboardStats() {
            const reqCount = document.getElementById('req-count');
            const reqCompleted = document.getElementById('req-completed');
            const diagramCount = document.getElementById('diagram-count');
            const testCount = document.getElementById('test-count');
            
            if (reqCount) reqCount.textContent = currentProject.requirements.length;
            if (reqCompleted) reqCompleted.textContent = currentProject.requirements.filter(r => r.status === 'implemented').length;
            if (diagramCount) diagramCount.textContent = currentProject.diagrams.length;
            if (testCount) testCount.textContent = currentProject.testCases.length;
            
            // Прогресс
            const totalReqs = currentProject.requirements.length;
            const approvedReqs = currentProject.requirements.filter(r => r.status === 'approved' || r.status === 'implemented').length;
            const reqProgress = totalReqs > 0 ? Math.round((approvedReqs / totalReqs) * 100) : 0;
            
            const progressReq = document.getElementById('progress-req');
            const progressBarReq = document.getElementById('progress-bar-req');
            
            if (progressReq) progressReq.textContent = `${reqProgress}%`;
            if (progressBarReq) progressBarReq.style.width = `${reqProgress}%`;
            
            // Обновляем график
            initializeProjectChart();
        }

        function initializeProjectChart() {
            const canvas = document.getElementById('project-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Удаляем старый график если есть
            if (window.projectChart) {
                window.projectChart.destroy();
            }
            
            window.projectChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Требования', 'Диаграммы', 'Тест-кейсы', 'Процессы', 'Модели'],
                    datasets: [{
                        label: 'Количество',
                        data: [
                            currentProject.requirements.length,
                            currentProject.diagrams.length,
                            currentProject.testCases.length,
                            currentProject.processes.length,
                            currentProject.models.length
                        ],
                        backgroundColor: [
                            '#38bdf8',
                            '#10b981',
                            '#f59e0b',
                            '#8b5cf6',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: '#334155'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: '#334155'
                            }
                        }
                    }
                }
            });
        }

        // Сохранение и загрузка
        function saveToLocalStorage() {
            const data = {
                currentProject: currentProject,
                lastSave: new Date().toISOString()
            };
            
            localStorage.setItem('saToolkitProject', JSON.stringify(data));
            updateLastSaveTime();
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('saToolkitProject');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    currentProject = data.currentProject || currentProject;
                    
                    const projectName = document.getElementById('project-name');
                    const currentProjectSpan = document.getElementById('current-project');
                    
                    if (projectName) projectName.textContent = currentProject.name;
                    if (currentProjectSpan) currentProjectSpan.textContent = `Проект: ${currentProject.name}`;
                } catch (error) {
                    console.error('Ошибка загрузки данных:', error);
                }
            }
        }

        function updateLastSaveTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            const lastSave = document.getElementById('last-save');
            if (lastSave) {
                lastSave.textContent = timeString;
            }
        }

        // Уведомления
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            const notificationIcon = document.getElementById('notification-icon');
            
            if (!notification || !notificationText || !notificationIcon) return;
            
            notificationText.textContent = message;
            
            let iconName = 'info';
            let bgColor = 'bg-slate-800';
            let textColor = 'text-slate-200';
            let borderColor = 'border-slate-700';
            
            switch(type) {
                case 'success':
                    iconName = 'check-circle';
                    bgColor = 'bg-emerald-900/80';
                    textColor = 'text-emerald-100';
                    borderColor = 'border-emerald-700';
                    break;
                case 'error':
                    iconName = 'alert-circle';
                    bgColor = 'bg-red-900/80';
                    textColor = 'text-red-100';
                    borderColor = 'border-red-700';
                    break;
                case 'warning':
                    iconName = 'alert-triangle';
                    bgColor = 'bg-amber-900/80';
                    textColor = 'text-amber-100';
                    borderColor = 'border-amber-700';
                    break;
            }
            
            notificationIcon.setAttribute('data-lucide', iconName);
            
            if (window.lucide && window.lucide.createIcons) {
                lucide.createIcons();
            }
            
            notification.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${bgColor} ${textColor} border ${borderColor}`;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 5000);
        }

        // Функции в разработке
        function generateTestsFromRequirements() {
            showNotification('Генерация тестов из требований в разработке', 'info');
        }

        function importRequirements() {
            showNotification('Импорт требований в разработке', 'info');
        }

        function exportRequirements() {
            showNotification('Экспорт требований в разработке', 'info');
        }

        function addApiEndpoint() {
            showNotification('Добавление API endpoint в разработке', 'info');
        }

        function importSwagger() {
            showNotification('Импорт Swagger в разработке', 'info');
        }

        function exportOpenAPI() {
            showNotification('Экспорт OpenAPI в разработке', 'info');
        }

        function addApiParam() {
            showNotification('Добавление параметра API в разработке', 'info');
        }

        function addProcess() {
            showNotification('Добавление процесса в разработке', 'info');
        }

        function analyzeProcess() {
            showNotification('Анализ процесса в разработке', 'info');
        }

        function addDataModel() {
            showNotification('Добавление модели данных в разработке', 'info');
        }

        function generateSQL() {
            showNotification('Генерация SQL в разработке', 'info');
        }

        function autoTraceRequirements() {
            showNotification('Авто-трассировка в разработке', 'info');
        }

        function exportTraceabilityMatrix() {
            showNotification('Экспорт матрицы трассируемости в разработке', 'info');
        }

        // Матрица трассируемости
        function renderTraceabilityMatrix() {
            const matrix = document.getElementById('traceability-matrix');
            if (!matrix) return;
            
            matrix.innerHTML = '';
            
            // Создаем заголовки
            const requirements = currentProject.requirements;
            const tests = currentProject.testCases;
            
            if (requirements.length === 0 || tests.length === 0) {
                matrix.innerHTML = '<div class="p-4 text-slate-400 text-center">Добавьте требования и тест-кейсы для построения матрицы</div>';
                return;
            }
            
            // Обновляем статистику
            updateTraceabilityStats();
        }

        function updateTraceabilityStats() {
            const totalReqs = currentProject.requirements.length;
            const totalTests = currentProject.testCases.length;
            const linkedTests = currentProject.testCases.filter(t => t.requirementId).length;
            const coverage = totalReqs > 0 ? Math.round((linkedTests / totalReqs) * 100) : 0;
            
            const traceReqCount = document.getElementById('trace-req-count');
            const traceTestsCount = document.getElementById('trace-tests-count');
            const traceTasksCount = document.getElementById('trace-tasks-count');
            const traceCoverage = document.getElementById('trace-coverage');
            
            if (traceReqCount) traceReqCount.textContent = totalReqs;
            if (traceTestsCount) traceTestsCount.textContent = totalTests;
            if (traceTasksCount) traceTasksCount.textContent = linkedTests;
            if (traceCoverage) traceCoverage.textContent = `${coverage}%`;
        }

        // Глобальные функции для отладки
        window.app = {
            currentProject,
            saveToLocalStorage,
            loadFromLocalStorage,
            showNotification,
            exportAllData
        };
        
        console.log('Приложение SA Toolkit Pro загружено и готово к работе');
    </script>
</body>
</html>
